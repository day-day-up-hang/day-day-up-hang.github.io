<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 6.1.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"example.com","root":"/","scheme":"Muse","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta property="og:type" content="website">
<meta property="og:title" content="Hexo">
<meta property="og:url" content="http://example.com/page/2/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="John Doe">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="http://example.com/page/2/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'en'
  };
</script>

  <title>Hexo</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">Hexo</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>Categories</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index posts-expand">
            
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://example.com/2022/04/05/conda%E5%AE%89%E8%A3%85/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="John Doe">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/04/05/conda%E5%AE%89%E8%A3%85/" class="post-title-link" itemprop="url">conda安装</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>
              

              <time title="Created: 2022-04-05 15:15:42 / Modified: 15:16:11" itemprop="dateCreated datePublished" datetime="2022-04-05T15:15:42+08:00">2022-04-05</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%97%A5%E5%B8%B8/" itemprop="url" rel="index"><span itemprop="name">日常</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>Welcome to unique_Hang’s blog.</p>
<blockquote>
<p><strong>鲁迅说过：看unique_Hang博客的人颜值都很高！</strong>  </p>
<p>打不开图片可以鼠标右键点击“复制图片地址”在新窗口中打开</p>
<p> 作者邮箱：<a href="mailto:unique_hang@qq.com">unique_hang@qq.com</a><br>喜欢的小伙伴可以关注我的b站账号(<a target="_blank" rel="noopener" href="https://space.bilibili.com/290100464">https://space.bilibili.com/290100464</a>)  </p>
</blockquote>
<p>进入Anaconda的<a target="_blank" rel="noopener" href="https://www.anaconda.com/download/">官网</a>进行下载</p>
<p>点击Download按钮</p>
<p><strong>配置环境变量：如果你在安装过程中勾选了Add PATH 那个选项，那么你不需要额外配置环境变量，但是如果你没有勾选（默认是不勾选的）</strong></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://example.com/2022/04/05/colab%E7%9A%84GPU%E7%99%BD%E5%AB%96/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="John Doe">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/04/05/colab%E7%9A%84GPU%E7%99%BD%E5%AB%96/" class="post-title-link" itemprop="url">colab的GPU白嫖</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>
              

              <time title="Created: 2022-04-05 15:15:02 / Modified: 15:15:25" itemprop="dateCreated datePublished" datetime="2022-04-05T15:15:02+08:00">2022-04-05</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%97%A5%E5%B8%B8/" itemprop="url" rel="index"><span itemprop="name">日常</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>Welcome to unique_Hang’s blog.</p>
<blockquote>
<p><strong>鲁迅说过：看unique_Hang博客的人颜值都很高！</strong>  </p>
<p>打不开图片可以鼠标右键点击“复制图片地址”在新窗口中打开</p>
<p> 作者邮箱：<a href="mailto:unique_hang@qq.com">unique_hang@qq.com</a><br>喜欢的小伙伴可以关注我的b站账号(<a target="_blank" rel="noopener" href="https://space.bilibili.com/290100464">https://space.bilibili.com/290100464</a>)  </p>
</blockquote>
<h1 id="登录-Google-云端硬盘"><a href="#登录-Google-云端硬盘" class="headerlink" title="登录 Google 云端硬盘"></a>登录 Google 云端硬盘</h1><p>网址：<a target="_blank" rel="noopener" href="https://drive.google.com/drive/my-drive">https://drive.google.com/drive/my-drive</a></p>
<h1 id="连接到本地"><a href="#连接到本地" class="headerlink" title="连接到本地"></a>连接到本地</h1><p>conda进入想要的环境，输入</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">jupyter notebook  --NotebookApp.allow_origin=&#x27;https://colab.research.google.com&#x27;  --port=8888  --NotebookApp.port_retries=0</span><br></pre></td></tr></table></figure>

<p>把得到的地址粘贴到“连接本地时”</p>
<h1 id="如何使用GPU"><a href="#如何使用GPU" class="headerlink" title="如何使用GPU"></a>如何使用GPU</h1><p>首先，要使用Google的产品，翻墙是必须的吧。 然后点击进入Google云端硬盘，如下界面：</p>
<p><img src="https://wx1.sinaimg.cn/mw1024/007BSstUly1goo5wukmckj30k00antc2.jpg" alt="img"></p>
<p>然后点击新建–更多–Colaboratory,就会出现这个界面，</p>
<p><img src="https://wx4.sinaimg.cn/mw1024/007BSstUly1goo5wyyalgj30k00antc2.jpg" alt="img"></p>
<p>红框可以修改页面名称，绿框点击连接（点击第一个：<strong>连接到托管代码执行程序</strong>），但是连接之后并不是以及在GPU环境下，所以需要点击蓝框进行设置，</p>
<p><img src="https://wx2.sinaimg.cn/mw1024/007BSstUly1goo5x4qnndj30k00algnt.jpg" alt="img"></p>
<p>点击篮框就会出现如下界面</p>
<p><img src="https://wx1.sinaimg.cn/mw1024/007BSstUly1goo5xc0svuj30k00akac4.jpg" alt="img"></p>
<p>然后就可以选择GPU&#x2F;TPU，最后只需要点击保存就行了。</p>
<p><img src="https://wx2.sinaimg.cn/mw1024/007BSstUly1goo5xek3j5j30k00amtav.jpg" alt="img"></p>
<p>因为TensorFlow本身就是Google的所以也不需要安装，直接用就行了，如何确定自己是否已经在GPU的环境下只需要输入这段代码就行了</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">import tensorflow as tf</span><br><span class="line">tf.test.gpu_device_name()</span><br><span class="line"></span><br><span class="line">---</span><br><span class="line">&#x27;/device:GPU:0&#x27;</span><br></pre></td></tr></table></figure>

<p>如果输出和上面一样的话就是已经在GPU环境下了。</p>
<p>接着是Pytorch, Pytorch的安装和我们在Linux上安装一样,点击<a href="https://link.zhihu.com/?target=https://pytorch.org/">官网</a>选择要环境。然后只需要将官网提供的代码copy到我们的代码块中，<strong>并且在代码前加上一个“!”点击运行即可，如下</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">!pip3 install https://download.pytorch.org/whl/cu80/torch-1.0.0-cp36-cp36m-linux_x86_64.whl</span><br><span class="line">!pip3 install torchvision</span><br></pre></td></tr></table></figure>

<p>然后我们可以输入官网提供的代码作安装的测试 如果有如下输出就证明我们安装成功</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">import torch</span><br><span class="line">x = torch.empty(5, 3)</span><br><span class="line">print(x)</span><br><span class="line"></span><br><span class="line">tensor([[1.1790e-25, 0.0000e+00, 4.4842e-44],</span><br><span class="line">        [0.0000e+00,        nan, 1.6255e-43],</span><br><span class="line">        [3.3587e-06, 5.2898e+22, 6.5625e-10],</span><br><span class="line">        [2.0804e+23, 8.2726e+20, 6.6715e-10],</span><br><span class="line">        [1.6993e-04, 2.7150e-06, 6.0611e-39]])</span><br></pre></td></tr></table></figure>

<p>以上步骤<strong>如图</strong>所示</p>
<p><img src="https://wx1.sinaimg.cn/mw1024/007BSstUly1goo5xiqw2sj30k00alq5m.jpg" alt="img"></p>
<p>运行如下代码可以查看GPU显存信息</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">!/opt/<span class="built_in">bin</span>/nvidia-smi</span><br></pre></td></tr></table></figure>

<p><img src="https://pic4.zhimg.com/80/v2-43838a32b7f1acbe803f0b74fe2293f3_720w.jpg" alt="img"></p>
<p>上图是19年年初之前用的GPU还是K80，现在已经更换为T4</p>
<p><img src="https://pic1.zhimg.com/80/v2-25f65415fc78a659a0072ae33eaa8ccc_720w.jpg" alt="img"></p>
<p>如果要安装其他的包，框架，或者某一版本的方法和我们在Linux环境下安装几乎没有差别 只需要注意在运行前加上“!”，换计划说你可以把Google Colab看成是一个Linux系统的页面。</p>
<h1 id="导入dataset"><a href="#导入dataset" class="headerlink" title="导入dataset"></a>导入dataset</h1><p>最好导入dataset的压缩包</p>
<h1 id="文件解压："><a href="#文件解压：" class="headerlink" title="文件解压："></a><strong>文件解压：</strong></h1><p>当利用colab进行模型训练，且训练文件数目过大时，需要上传zip文件，并在google drive中解压。<br>经测试，利用chrome unzip插件解压速度远小于利用colab代码层解压。</p>
<ol>
<li>在colab中创建一个“unzipfile.ipynb”</li>
<li>手动创建解压目录</li>
<li>加入如下代码：</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">from google.colab import drive</span><br><span class="line">drive.mount(&#x27;/gdrive&#x27;) ## mount drive</span><br><span class="line"></span><br><span class="line">!unzip &#x27;/gdrive/My Drive/siim/701123_1225697_bundle_archive.zip&#x27; -d &#x27;/gdrive/My Drive/siim/Data/&#x27;</span><br><span class="line"></span><br><span class="line">#/gdrive/My Drive/是到“我的云端硬盘”</span><br></pre></td></tr></table></figure>

<h1 id="修改工作路径"><a href="#修改工作路径" class="headerlink" title="修改工作路径"></a>修改工作路径</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">import os</span><br><span class="line">from google.colab import drive</span><br><span class="line">drive.mount(&#x27;/content/gdrive&#x27;)</span><br><span class="line"> </span><br><span class="line">path = &quot;/content/gdrive/My Drive/GAN&quot;</span><br><span class="line">os.chdir(path)</span><br><span class="line">print(os.getcwd())</span><br></pre></td></tr></table></figure>



<h1 id="从drive导入模块"><a href="#从drive导入模块" class="headerlink" title="从drive导入模块"></a>从drive导入模块</h1><p>If you have some custom modules that you want to use in you notebook, you can upload them on Drive and import them later. Let’s see how.</p>
<p>如果您有一些要在笔记本中使用的自定义模块，则可以将其上传到云端硬盘中，然后再导入。 让我们看看如何。</p>
<p>Before you can import them, you have to tell Python were to look. First, create a <code>Project</code> folder where we will put our <code>.py</code> files. Then you need to execute:</p>
<p>在导入它们之前，您必须告诉Python要外观。 首先，创建一个<code>Project</code>文件夹，在其中放置我们的<code>.py</code>文件。 然后您需要执行：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">import sys</span><br><span class="line"></span><br><span class="line">sys.path.insert(0, &#x27;/content/drive/My Drive/Project&#x27;)</span><br></pre></td></tr></table></figure>

<p>After executing the cell above, your modules will import without errors:</p>
<p>执行完上面的单元格后，您的模块将无错误地导入：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">import foo</span><br><span class="line">import bar</span><br></pre></td></tr></table></figure>

<p>Why is this necessary? When you write <code>import foo</code>, Python looks for a module named <code>foo</code> in a predefined list of locations called <code>sys.path</code>. By inserting the location of our modules as the first entry we make sure that <code>foo</code> and <code>bar</code> will be found.</p>
<p>为什么这是必要的？ 当您编写<code>import foo</code> ，Python将在名为<code>sys.path</code>的预定义位置列表中查找名为<code>foo</code>的模块。 通过插入模块的位置作为第一个条目，我们确保将找到<code>foo</code>和<code>bar</code> 。</p>
<p>Note that this trick is a kind of workaround that will make many expert Python practitioners uneasy. Abusing this hack on you personal computer, or on a production server, will likely lead to a messy import path and unpredictable consequences if you have different modules with the same name. However in the case of the experimental and temporary environment of the notebook this may be acceptable.</p>
<p>请注意，此技巧是一种变通办法，它将使许多Python专业人士变得不安。 如果您具有相同名称的不同模块，则在您的个人计算机或生产服务器上滥用此黑客可能会导致导入路径混乱，并导致不可预知的后果。 但是，在笔记本电脑的实验性和临时性环境中，这是可以接受的。</p>
<h1 id="GPU的使用"><a href="#GPU的使用" class="headerlink" title="GPU的使用"></a>GPU的使用</h1><p>在训练前加入with tf.device(“&#x2F;gpu:0”):比如</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">with</span> tf.device(<span class="string">&quot;/gpu:0&quot;</span>):</span><br><span class="line">  history = model.fit(train_images, train_labels, epochs=<span class="number">15</span>,</span><br><span class="line">                      <span class="comment">#validation_data=(test_images, test_labels),</span></span><br><span class="line">                      shuffle=<span class="literal">True</span>,<span class="comment">#打乱数据</span></span><br><span class="line">                      validation_split=<span class="number">0.1</span>,</span><br><span class="line">                      callbacks=callbacks)</span><br></pre></td></tr></table></figure>



<h1 id="Colab-Kaggle-防断开脚本"><a href="#Colab-Kaggle-防断开脚本" class="headerlink" title="Colab Kaggle 防断开脚本"></a>Colab Kaggle 防断开脚本</h1><h3 id="Colab-防断开"><a href="#Colab-防断开" class="headerlink" title="Colab 防断开"></a>Colab 防断开</h3><p>鼠标右键，检查，在console先输入如下代码</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">function ConnectButton()&#123;</span><br><span class="line">    console.log(&quot;Connect pushed&quot;); </span><br><span class="line">    document.querySelector(&quot;#top-toolbar &gt; colab-connect-button&quot;).shadowRoot.querySelector(&quot;#connect&quot;).click() </span><br><span class="line">&#125;</span><br><span class="line">setInterval(ConnectButton,60000);</span><br></pre></td></tr></table></figure>

<p>过几秒钟再输入如下代码：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">function closeButton()&#123;</span><br><span class="line">    console.log(&quot;close&quot;); </span><br><span class="line">    document.querySelector(&quot;body &gt; colab-dialog &gt; paper-dialog &gt; colab-sessions-dialog&quot;).shadowRoot.querySelector(&quot;#footer &gt; div &gt; paper-button.dismiss&quot;).click() </span><br><span class="line">&#125;</span><br><span class="line">setInterval(ConnectButton,60000);</span><br></pre></td></tr></table></figure>

<h3 id="kaggle防断开"><a href="#kaggle防断开" class="headerlink" title="kaggle防断开"></a>kaggle防断开</h3><p>先输入</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">function closeButton()&#123;</span><br><span class="line">    console.log(&quot;close&quot;); </span><br><span class="line">   document.querySelector(&quot;#root &gt; div &gt; div &gt; div.AppView-sc-16eb2j.kZXkZl &gt; div.App_Body-sc-16c8j4p.hxOBfv &gt; div.Layout_Body-sc-6piylv.bXAYPy &gt; div &gt; div &gt; div &gt; div.ToolbarContainer_Body-sc-2h8iu7.fhvgBU &gt; button&quot;).click() </span><br><span class="line">&#125;</span><br><span class="line">setInterval(closeButton,60000);</span><br></pre></td></tr></table></figure>

<p>过几秒再输入</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">function closeButton()&#123;</span><br><span class="line">    console.log(&quot;close&quot;); </span><br><span class="line">    document.querySelector(&quot;#root &gt; div &gt; div &gt; div.AppView-sc-16eb2j.kZXkZl &gt; div.App_Body-sc-16c8j4p.hxOBfv &gt; div.Layout_Body-sc-6piylv.bXAYPy &gt; div &gt; div &gt; div &gt; div.ToolbarContainer_Body-sc-2h8iu7.fhvgBU &gt; div.DetailedStatus_Body-sc-zfwb95.fMzpPO &gt; button &gt; i&quot;).click() </span><br><span class="line">&#125;</span><br><span class="line">setInterval(closeButton,60000);</span><br></pre></td></tr></table></figure>


      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://example.com/2022/04/05/c++%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83%E5%AE%89%E8%A3%85/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="John Doe">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/04/05/c++%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83%E5%AE%89%E8%A3%85/" class="post-title-link" itemprop="url">c++开发环境安装</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>
              

              <time title="Created: 2022-04-05 15:14:27 / Modified: 15:14:52" itemprop="dateCreated datePublished" datetime="2022-04-05T15:14:27+08:00">2022-04-05</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%97%A5%E5%B8%B8/" itemprop="url" rel="index"><span itemprop="name">日常</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>Welcome to unique_Hang’s blog.</p>
<blockquote>
<p><strong>鲁迅说过：看unique_Hang博客的人颜值都很高！</strong>  </p>
<p>打不开图片可以鼠标右键点击“复制图片地址”在新窗口中打开</p>
<p> 作者邮箱：<a href="mailto:unique_hang@qq.com">unique_hang@qq.com</a><br>喜欢的小伙伴可以关注我的b站账号(<a target="_blank" rel="noopener" href="https://space.bilibili.com/290100464">https://space.bilibili.com/290100464</a>)  </p>
</blockquote>
<h1 id="C-开发环境搭建"><a href="#C-开发环境搭建" class="headerlink" title="C++开发环境搭建"></a>C++开发环境搭建</h1><h2 id="1-下载软件"><a href="#1-下载软件" class="headerlink" title="1 下载软件"></a>1 下载软件</h2><p>官网：<a target="_blank" rel="noopener" href="https://visualstudio.microsoft.com/">https://visualstudio.microsoft.com/</a></p>
<p>选择 下载Windows版，并选择Community 社区版本进行下载</p>
<p><img src="https://wx4.sinaimg.cn/mw1024/007BSstUgy1gpuwqtviz5j30ia070aai.jpg"></p>
<h2 id="2-安装软件"><a href="#2-安装软件" class="headerlink" title="2 安装软件"></a>2 安装软件</h2><p>双击运行下载的安装文件，弹出安装界面</p>
<p>选择 <strong>使用C++的桌面开发</strong> 这一选项</p>
<p>点击安装按钮</p>
<p><img src="https://wx3.sinaimg.cn/mw1024/007BSstUgy1gpuwty72o2j30zu0k076t.jpg"></p>
<p>开始安装</p>
<p>安装成功后提示重启，点击重启完成剩余配置</p>
<h2 id="3-运行软件"><a href="#3-运行软件" class="headerlink" title="3 运行软件"></a>3 运行软件</h2><p>在开始菜单找到Visual Studio并且点击运行</p>
<p>弹出初始界面</p>
<p>点击 <strong>创建新项目</strong> 按钮 ，如果出现以下模板选项，证明安装成功，并可以创建C++项目！</p>
<p><img src="https://wx3.sinaimg.cn/mw1024/007BSstUgy1gpuwwr8ymtj30q50fz75a.jpg"></p>
<p>至此，C++的开发环境搭建完毕！</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://example.com/2022/04/05/aid%20learning%E4%BD%BF%E7%94%A8%E7%AC%94%E8%AE%B0/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="John Doe">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/04/05/aid%20learning%E4%BD%BF%E7%94%A8%E7%AC%94%E8%AE%B0/" class="post-title-link" itemprop="url">aid learning使用笔记</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>
              

              <time title="Created: 2022-04-05 15:13:03 / Modified: 15:14:15" itemprop="dateCreated datePublished" datetime="2022-04-05T15:13:03+08:00">2022-04-05</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%97%A5%E5%B8%B8/" itemprop="url" rel="index"><span itemprop="name">日常</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>Welcome to unique_Hang’s blog.</p>
<blockquote>
<p><strong>鲁迅说过：看unique_Hang博客的人颜值都很高！</strong>  </p>
<p>打不开图片可以鼠标右键点击“复制图片地址”在新窗口中打开</p>
<p> 作者邮箱：<a href="mailto:unique_hang@qq.com">unique_hang@qq.com</a><br>喜欢的小伙伴可以关注我的b站账号(<a target="_blank" rel="noopener" href="https://space.bilibili.com/290100464">https://space.bilibili.com/290100464</a>)  </p>
</blockquote>
<h1 id="安装QQ"><a href="#安装QQ" class="headerlink" title="安装QQ"></a>安装QQ</h1><p>下载网址：<a target="_blank" rel="noopener" href="https://im.qq.com/linuxqq/download.html">https://im.qq.com/linuxqq/download.html</a></p>
<ul>
<li><p>通过uname -a命令发现系统是arm64（aarch64）系统</p>
</li>
<li><p>所以下载arm64的shell，</p>
</li>
<li><p>当前版本的Linux QQ依赖gtk2.0，终端输入</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">apt-get update</span><br><span class="line">apt-get install sudo</span><br><span class="line">sudo apt install libgtk2.0-0</span><br></pre></td></tr></table></figure>
</li>
<li><p>安装QQ即可</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo ./linuxqq_1.0.1-b1-100_x86_64.sh</span><br></pre></td></tr></table></figure></li>
</ul>
<h1 id="安装Archiconda3"><a href="#安装Archiconda3" class="headerlink" title="安装Archiconda3"></a>安装Archiconda3</h1><p>下载网址：<a target="_blank" rel="noopener" href="https://github.com/Archiconda/build-tools/releases">https://github.com/Archiconda/build-tools/releases</a></p>
<ul>
<li><p>在终端安装</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bash Archiconda3-0.2.3-Linux-aarch64.sh</span><br></pre></td></tr></table></figure>

<p><strong>1、将anaconda的bin目录加入PATH，输入：</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">echo &#x27;export PATH=&quot;/root/archiconda3/bin:$PATH&quot;&#x27; &gt;&gt; ~/.bashrc</span><br></pre></td></tr></table></figure>

<p>根据版本不同，也可能是~&#x2F;anaconda2&#x2F;bin</p>
<p><strong>2、更新bashrc以立即生效，输入：</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">source ~/.bashrc</span><br></pre></td></tr></table></figure>
</li>
<li><p>为了方便使用，我们配置一下环境变量，为每个版本的Python设置一个别名。另外为了后面方便使用“pip”来管理虚拟环境的包，我们为虚拟环境的“pip”命令也创建一个别名。</p>
<p>编辑“~&#x2F;.bashrc”文件，在文件末尾增加如下内容：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">alias python=&quot;/usr/bin/python2&quot;</span><br><span class="line">alias python3=&quot;/usr/bin/python3&quot;</span><br><span class="line">alias apython=&quot;/home/lqhou/anaconda3/envs/apython/bin/python3&quot;</span><br><span class="line">alias apip=&quot;/home/lqhou/anaconda3/envs/apython/bin/pip&quot;</span><br></pre></td></tr></table></figure>

<p>注意Anaconda的路径要根据实际情况来填写，“&#x2F;home&#x2F;lqhou&#x2F;anaconda3”为作者系统上Anaconda的安装路径。配置完成后键入“source ~&#x2F;.bashrc”让配置生效，之后我们分别执行“python”、“python3”和“apython”命令：</p>
</li>
<li><p>下载之后就和普通的anaconda一模一样。直接执行安装，会装一个基本的环境。但真正用的时候还是会<code>conda create -p /prefix/path</code>这样创建环境，然后<code>source activate /prefix/path</code>激活并使用，也就是通常所说的最佳实践。</p>
</li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://example.com/2022/04/05/DenseDepth/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="John Doe">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/04/05/DenseDepth/" class="post-title-link" itemprop="url">DenseDepth</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>
              

              <time title="Created: 2022-04-05 15:07:58 / Modified: 15:08:28" itemprop="dateCreated datePublished" datetime="2022-04-05T15:07:58+08:00">2022-04-05</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0/" itemprop="url" rel="index"><span itemprop="name">深度学习</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>Welcome to unique_Hang’s blog.</p>
<blockquote>
<p><strong>鲁迅说过：看unique_Hang博客的人颜值都很高！</strong>  </p>
<p>打不开图片可以鼠标右键点击“复制图片地址”在新窗口中打开</p>
<p> 作者邮箱：<a href="mailto:unique_hang@qq.com">unique_hang@qq.com</a><br>喜欢的小伙伴可以关注我的b站账号(<a target="_blank" rel="noopener" href="https://space.bilibili.com/290100464">https://space.bilibili.com/290100464</a>)  </p>
</blockquote>
<h2 id="DenseDepth运行记录"><a href="#DenseDepth运行记录" class="headerlink" title="DenseDepth运行记录"></a>DenseDepth运行记录</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">pip install --ignore-installed --upgrade -i https://pypi.tuna.tsinghua.edu.cn/simple tensorflow-gpu==1.13.1</span><br><span class="line"></span><br><span class="line">pip install --ignore-installed --upgrade -i https://pypi.tuna.tsinghua.edu.cn/simple keras==2.2.4</span><br><span class="line"></span><br><span class="line">pip install h5py==2.10</span><br><span class="line"></span><br><span class="line">pip install matplotlib</span><br><span class="line"></span><br><span class="line">pip install scikit-image</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">python test.py</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">pip install opencv-python</span><br><span class="line"></span><br><span class="line">pip install scikit-learn</span><br><span class="line"></span><br><span class="line">pip install pydot</span><br><span class="line"></span><br><span class="line">conda install GraphViz --channel conda-forge -y</span><br><span class="line"></span><br><span class="line">python train.py --data nyu --gpus 0 --bs 8</span><br></pre></td></tr></table></figure>



<p>服务器代码已经跑通，用的conda的pytorch环境</p>
<p>不需要提取数据集，因为在训练时代码会将整个zip文件加载到内存中。</p>
<p>参考：</p>
<p><a target="_blank" rel="noopener" href="https://www.youtube.com/watch?v=Kja394OvoGY">https://www.youtube.com/watch?v=Kja394OvoGY</a><br><a target="_blank" rel="noopener" href="https://github.com/ialhashim/DenseDepth">https://github.com/ialhashim/DenseDepth</a><br><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/257985868">https://zhuanlan.zhihu.com/p/257985868</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://example.com/2022/04/05/yolov5%E4%BD%BF%E7%94%A8/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="John Doe">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/04/05/yolov5%E4%BD%BF%E7%94%A8/" class="post-title-link" itemprop="url">yolov5使用</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>
              

              <time title="Created: 2022-04-05 14:52:53 / Modified: 14:53:14" itemprop="dateCreated datePublished" datetime="2022-04-05T14:52:53+08:00">2022-04-05</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0/" itemprop="url" rel="index"><span itemprop="name">深度学习</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>Welcome to unique_Hang’s blog.</p>
<blockquote>
<p><strong>鲁迅说过：看unique_Hang博客的人颜值都很高！</strong><br> 作者邮箱：<a href="mailto:unique_hang@qq.com">unique_hang@qq.com</a><br>喜欢的小伙伴可以关注我的<a target="_blank" rel="noopener" href="https://space.bilibili.com/290100464">b站账号</a>(<a target="_blank" rel="noopener" href="https://space.bilibili.com/290100464">https://space.bilibili.com/290100464</a>)  </p>
</blockquote>
<p>1.安装环境。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">conda create -n yolov5 python=3.8 pytorch torchvision cudatoolkit=10.2 -c pytorch </span><br><span class="line"></span><br><span class="line">pip install -r requirements.txt</span><br></pre></td></tr></table></figure>

<p>2.制作数据集</p>
<ul>
<li>使用labelImg打标xml文件</li>
<li>数据集转化，运行  格式转换.py  并设置标签种类和训练集验证集种类，生成images和labels文件夹</li>
<li>在data文件夹中更改mydata.yaml中的路径，类别和类别数</li>
<li>只修改models文件夹中改mydata.yaml文件中的类别数</li>
</ul>
<p>3.训练</p>
<ul>
<li>修改train.py文件，主要修改前三个</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">parser.add_argument(&#x27;--weights&#x27;, type=str, default=ROOT / &#x27;yolov5s.pt&#x27;, help=&#x27;initial weights path&#x27;)</span><br><span class="line">parser.add_argument(&#x27;--cfg&#x27;, type=str, default=&#x27;models/mydata.yaml&#x27;, help=&#x27;model.yaml path&#x27;)</span><br><span class="line">parser.add_argument(&#x27;--data&#x27;, type=str, default=ROOT / &#x27;data/mydata.yaml&#x27;, help=&#x27;dataset.yaml path&#x27;)</span><br></pre></td></tr></table></figure>

<ul>
<li>设置线程数为0（最小）</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">parser.add_argument(&#x27;--workers&#x27;, type=int, default=0, help=&#x27;maximum number of dataloader workers&#x27;)#线程数</span><br></pre></td></tr></table></figure>



<p>训练完权重会保存在runs&#x2F;train&#x2F;exp&#x2F;weights中。</p>
<p>4.验证</p>
<p>找到detect.py’文件，更改权重地址和检测文件地址</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">parser.add_argument(&#x27;--weights&#x27;, nargs=&#x27;+&#x27;, type=str, default=ROOT / &#x27;yolov5s.pt&#x27;, help=&#x27;model path(s)&#x27;)</span><br><span class="line">parser.add_argument(&#x27;--source&#x27;, type=str, default=ROOT / &#x27;data/images&#x27;, help=&#x27;file/dir/URL/glob, 0 for webcam&#x27;)#检测图片/视频</span><br></pre></td></tr></table></figure>


      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://example.com/2022/04/05/yolov3%E4%BD%BF%E7%94%A8%E6%96%B9%E6%B3%95/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="John Doe">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/04/05/yolov3%E4%BD%BF%E7%94%A8%E6%96%B9%E6%B3%95/" class="post-title-link" itemprop="url">yolov3使用方法</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>
              

              <time title="Created: 2022-04-05 14:52:24 / Modified: 14:52:48" itemprop="dateCreated datePublished" datetime="2022-04-05T14:52:24+08:00">2022-04-05</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0/" itemprop="url" rel="index"><span itemprop="name">深度学习</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>Welcome to unique_Hang’s blog.</p>
<blockquote>
<p><strong>鲁迅说过：看unique_Hang博客的人颜值都很高！</strong><br> 作者邮箱：<a href="mailto:unique_hang@qq.com">unique_hang@qq.com</a><br>喜欢的小伙伴可以关注我的<a target="_blank" rel="noopener" href="https://space.bilibili.com/290100464">b站账号</a>(<a target="_blank" rel="noopener" href="https://space.bilibili.com/290100464">https://space.bilibili.com/290100464</a>)  </p>
</blockquote>
<h1 id="1-用labelImg标注图片（文件夹中的exe文件）"><a href="#1-用labelImg标注图片（文件夹中的exe文件）" class="headerlink" title="1.用labelImg标注图片（文件夹中的exe文件）"></a>1.用labelImg标注图片（文件夹中的exe文件）</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">注意标注文件夹不能有中文</span><br><span class="line"></span><br><span class="line">pip install PyQt5</span><br><span class="line">pip install pyqt5-tools</span><br><span class="line">pip install lxml</span><br><span class="line">pip install labelImg</span><br><span class="line"></span><br><span class="line">终端输入labelImg打开</span><br></pre></td></tr></table></figure>

<ol>
<li>点击Open Dir打开数据集</li>
<li>点击Create RectBox打标签（快捷键：W）</li>
<li>保存（选择一个文件夹，得到xml后缀文件）</li>
<li>下一张，以此类推。（快捷键：A上一张 D下一张）</li>
<li>标记完后把xml文件全部放在.\VOCdevkit_fire\VOC2012\Annotations文件夹下</li>
</ol>
<h1 id="2-生成训练集-测试集"><a href="#2-生成训练集-测试集" class="headerlink" title="2.生成训练集\测试集"></a>2.生成训练集\测试集</h1><ol>
<li><p>运行“获取文件名字.py”，得到my_train.txt和my_val.txt。<strong>1.注意改路径，2.若文档最后有空行会报错！！</strong></p>
</li>
<li><p>在data文件夹中建立标签文件：xxx.names，里面存放图片标签。</p>
</li>
<li><p>检测tools&#x2F;voc2012.py里路径和文件名是否需要修改</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">image_list = <span class="built_in">open</span>(os.path.join(</span><br><span class="line">        FLAGS.data_dir, <span class="string">&#x27;ImageSets&#x27;</span>, <span class="string">&#x27;Main&#x27;</span>, <span class="string">&#x27;my_%s.txt&#x27;</span> % FLAGS.split)).read().splitlines()</span><br><span class="line">    </span><br></pre></td></tr></table></figure>


</li>
<li><p>打开anaconda，激活yolov3-tf2-cpu，进入根目录，运行程序。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">(E:\Program Files\Anaconda3) C:\Users\Administrator&gt;activate yolov3-tf2-cpu</span><br><span class="line"></span><br><span class="line">(yolov3-tf2-cpu) C:\Users\Administrator&gt;e:</span><br><span class="line"></span><br><span class="line">(yolov3-tf2-cpu) E:\&gt;cd E:\PyCharm\work\yolo_tf2.1</span><br><span class="line"></span><br><span class="line">(yolov3-tf2-cpu) E:\PyCharm\work\yolo_tf2.1&gt;</span><br><span class="line"></span><br><span class="line">--------------运行下面--------------------</span><br><span class="line">#生产训练集</span><br><span class="line">python tools/voc2012.py --data_dir ./VOCdevkit_fire/VOC2012 --split train --output_file ./data/voc2012_train.tfrecord --classes=./data/fire_voc2012.names</span><br><span class="line">#生产测试集</span><br><span class="line">python tools/voc2012.py --data_dir ./VOCdevkit_fire/VOC2012 --split val --output_file ./data/voc2012_val.tfrecord --classes=./data/fire_voc2012.names</span><br></pre></td></tr></table></figure></li>
</ol>
<h1 id="3-进行迁移训练"><a href="#3-进行迁移训练" class="headerlink" title="3.进行迁移训练"></a>3.进行迁移训练</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python train.py --dataset ./data/voc2012_train.tfrecord --val_dataset ./data/voc2012_val.tfrecord --classes ./data/fire_voc2012.names --num_classes 1  --mode fit --transfer darknet --batch_size 4 --epochs 20 --weights ./checkpoints/yolov3.tf --weights_num_classes 80 </span><br></pre></td></tr></table></figure>

<p>需要修改的：–dataset训练集，–val_dataset测试集，–classes标签文件，–num_classes标签种类</p>
<p>每一个epoch会在checkpoints文件夹保存一次模型参数（yolov3_train_xx.tf）</p>
<h1 id="4-进行模型测试"><a href="#4-进行模型测试" class="headerlink" title="4.进行模型测试"></a>4.进行模型测试</h1><ul>
<li>图片测试</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python detect.py --classes ./data/fire_voc2012.names --num_classes 1 --weights ./checkpoints/yolov3_train_20.tf --image ./fire.jpg --yolo_score_threshold 0.3</span><br></pre></td></tr></table></figure>

<p>需要修改的：–classes 标签文件 –num_classes 标签个数 –weights 权重文件  –image 测试图片 –yolo_score_threshold 分割阈值</p>
<p>得到图片output.jpg</p>
<p>查全率测试：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">查看修改：weights，num_classes，判断（if nums[0] &gt; 1 or 0）</span><br><span class="line"></span><br><span class="line">python detect_all.py --yolo_score_threshold 0.3</span><br></pre></td></tr></table></figure>



<ul>
<li>视频测试</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python detect_video.py --classes ./data/fire_voc2012.names --num_classes 1 --weights ./checkpoints/yolov3_train_20.tf --video fire.mp4 --output ./output.avi --yolo_score_threshold 0.3</span><br></pre></td></tr></table></figure>

<p>得到视频output.jpg</p>
<ul>
<li>摄像头测试</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python detect_video.py --classes ./data/fire_voc2012.names --num_classes 1 --weights ./checkpoints/yolov3_train_20.tf --video 0 --yolo_score_threshold 0.3</span><br></pre></td></tr></table></figure>



<h1 id="5-常见错误"><a href="#5-常见错误" class="headerlink" title="5.常见错误"></a>5.常见错误</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">data\xxx.names中标签错误</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Traceback (most recent call last):</span><br><span class="line">  File &quot;tools/voc2012.py&quot;, line 111, in &lt;module&gt;</span><br><span class="line">    app.run(main)</span><br><span class="line">  File &quot;E:\anaconda\envs\tf2\lib\site-packages\absl\app.py&quot;, line 303, in run</span><br><span class="line">    _run_main(main, args)</span><br><span class="line">  File &quot;E:\anaconda\envs\tf2\lib\site-packages\absl\app.py&quot;, line 251, in _run_main</span><br><span class="line">    sys.exit(main(argv))</span><br><span class="line">  File &quot;tools/voc2012.py&quot;, line 104, in main</span><br><span class="line">    tf_example = build_example(annotation, class_map)</span><br><span class="line">  File &quot;tools/voc2012.py&quot;, line 47, in build_example</span><br><span class="line">    classes.append(class_map[obj[&#x27;name&#x27;]])</span><br><span class="line">KeyError: &#x27;collision&#x27;</span><br></pre></td></tr></table></figure>







<h1 id="6-进阶——数据增强"><a href="#6-进阶——数据增强" class="headerlink" title="6.进阶——数据增强"></a>6.进阶——数据增强</h1><p>.\tools\数据增强    文件夹中把需要增强的图片和xml文件分别放入JPEGImages和Annotations文件夹中。</p>
<p>分别运行</p>
<p>增强.py    –&gt; 修改路径</p>
<p>即可</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://example.com/2022/04/05/ylolv%E5%90%88%E9%9B%86/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="John Doe">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/04/05/ylolv%E5%90%88%E9%9B%86/" class="post-title-link" itemprop="url">ylolv合集</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>
              

              <time title="Created: 2022-04-05 14:51:52 / Modified: 15:02:03" itemprop="dateCreated datePublished" datetime="2022-04-05T14:51:52+08:00">2022-04-05</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0/" itemprop="url" rel="index"><span itemprop="name">深度学习</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>Welcome to unique_Hang’s blog.</p>
<blockquote>
<p><strong>鲁迅说过：看unique_Hang博客的人颜值都很高！</strong>  </p>
<p>打不开图片可以鼠标右键点击“复制图片地址”在新窗口中打开</p>
<p> 作者邮箱：<a href="mailto:unique_hang@qq.com">unique_hang@qq.com</a><br>喜欢的小伙伴可以关注我的b站账号(<a target="_blank" rel="noopener" href="https://space.bilibili.com/290100464">https://space.bilibili.com/290100464</a>)  </p>
</blockquote>
<p><img src="https://wx3.sinaimg.cn/mw1024/007BSstUgy1gojk3cbzi3j31hc0u07hx.jpg"></p>
<p>参考资料：<a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1ez4y1X7g2">https://www.bilibili.com/video/BV1ez4y1X7g2</a></p>
<h1 id="yolov1"><a href="#yolov1" class="headerlink" title="yolov1"></a>yolov1</h1><p><img src="https://wx2.sinaimg.cn/mw690/007BSstUgy1goagu0gd59j309y0b943k.jpg"></p>
<p><strong>论文思想：</strong></p>
<ol>
<li><p>将一幅图像分成SxS个网格(grid cell)，如果某个目标（object）的中心落在这个网格中，则这个网格就负责预测这个目标（object）。</p>
</li>
<li><p>每个网格要预测B（一般B&#x3D;2）个bounding box，每个bounding box除了要预测位置之外，还要附带预测一个confidence值。每个网格还要预测c个类别的分数。每一个网格最终得到的预测值是2*5+c</p>
<p>注：confidence是Pr(Object)*IOU，有目标Pr(Object)&#x3D;1，无目标Pr(Object)&#x3D;0，IOU是预测的bounding box和真实的bounding box的交并比。2是两个bounding box，5是每个bounding box反馈五个值：x、y、w、h、confidence，c是c种类别</p>
</li>
</ol>
<p><strong>损失函数：</strong></p>
<p><img src="https://wx1.sinaimg.cn/mw690/007BSstUgy1goahw555vcj31350j542z.jpg"></p>
<p><strong>存在的问题：</strong></p>
<p>对小物体多个目标的预测不准确。</p>
<h1 id="yolov2"><a href="#yolov2" class="headerlink" title="yolov2"></a>yolov2</h1><p>七个改进：</p>
<ol>
<li>Batch Normalization.（使用BN层，取消了dropout层）</li>
<li>High Resolution Classifier，更高分辨率的分类器</li>
<li>Convolutional With Anchor Boxes，基于Anchor的目标检测框进行检测</li>
<li>Dimension Clusters，使用聚类算法提取anchor boxes的宽高</li>
<li>Direct location prediction（目标位置预测），对中心坐标偏移量进行限制，限制到0~1之间，这样可以让每个anchor(prior)去负责预测目标中心落在某个grid cell区域内的目标。</li>
<li>Fine-Grained Features，引入一种称为passthrough层的方法在特征图中保留一些细节信息</li>
<li>Multi-Scale Training（多尺寸训练）没有全连接层，只有卷积层和池化层，因此模型可以接受任意尺寸的输入。因为下采样率为32，所以选择的尺寸都是32的倍数，具体的范围为<img src="https://www.zhihu.com/equation?tex=%5C%7B320,+352,...,+608%5C%7D" alt="[公式]"></li>
<li>Darknet-19包含19个卷积层、5个最大值池化层（max pooling layers ）</li>
</ol>
<h1 id="yolov3"><a href="#yolov3" class="headerlink" title="yolov3"></a>yolov3</h1><ol>
<li><p>每个cell预测3个boxes（B&#x3D;3），每个box给出85个参数，如下：<img src="https://wx4.sinaimg.cn/mw1024/007BSstUgy1gomqprplvij30qu0b8wja.jpg"></p>
<p>其中N*N是图片分割出的cell数量。</p>
</li>
<li><p>网络结构：</p>
<p><img src="https://wx4.sinaimg.cn/mw1024/007BSstUgy1gomuz5y1ofj30x40pawlx.jpg"></p>
<p>Up Sampling是上采样层，高和宽会扩大到原来的两倍。</p>
</li>
<li><p>损失的计算：<img src="https://wx1.sinaimg.cn/mw1024/007BSstUgy1gomvcn79afj315h06040u.jpg"></p>
<p>置信度损失：<img src="https://wx4.sinaimg.cn/mw1024/007BSstUgy1gomvg767vmj313w0gxjwp.jpg"></p>
<p>类别损失：</p>
<p><img src="https://wx1.sinaimg.cn/mw1024/007BSstUgy1gomvke8x9vj31450ifwkf.jpg"></p>
<p>定位损失：<img src="https://wx1.sinaimg.cn/mw1024/007BSstUgy1gomvt82trjj30h00g9myn.jpg"></p>
</li>
</ol>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://example.com/2022/04/05/Unet%E8%AF%AD%E4%B9%89%E5%88%86%E5%89%B2/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="John Doe">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/04/05/Unet%E8%AF%AD%E4%B9%89%E5%88%86%E5%89%B2/" class="post-title-link" itemprop="url">Unet语义分割</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>
              

              <time title="Created: 2022-04-05 14:51:22 / Modified: 14:51:41" itemprop="dateCreated datePublished" datetime="2022-04-05T14:51:22+08:00">2022-04-05</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0/" itemprop="url" rel="index"><span itemprop="name">深度学习</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>Welcome to unique_Hang’s blog.</p>
<blockquote>
<p><strong>鲁迅说过：看unique_Hang博客的人颜值都很高！</strong><br> 作者邮箱：<a href="mailto:unique_hang@qq.com">unique_hang@qq.com</a><br>喜欢的小伙伴可以关注我的<a target="_blank" rel="noopener" href="https://space.bilibili.com/290100464">b站账号</a>(<a target="_blank" rel="noopener" href="https://space.bilibili.com/290100464">https://space.bilibili.com/290100464</a>)  </p>
</blockquote>
<p>原文网址：<a target="_blank" rel="noopener" href="http://www.arxiv.org/pdf/1505.04597.pdf">http://www.arxiv.org/pdf/1505.04597.pdf</a></p>
<p>Unet可以分为三个部分，如下图所示：</p>
<p>第一部分是<strong>主干特征提取部分</strong>，我们可以利用主干部分获得一个又一个的<strong>特征层</strong>，Unet的主干特征提取部分与VGG相似，为卷积和最大池化的堆叠。<strong>利用主干特征提取部分我们可以获得五个初步有效特征层</strong>，在第二步中，我们会利用这五个有效特征层可以进行特征融合。</p>
<p>第二部分是<strong>加强特征提取部分</strong>，我们可以利用主干部分获取到的五个初步有效特征层进行上采样，并且进行特征融合，获得一个最终的，融合了所有特征的有效特征层。</p>
<p>第三部分是<strong>预测部分</strong>，我们会利用最终获得的最后一个有效特征层对每一个特征点进行分类，相当于对每一个像素点进行分类。</p>
<p><img src="https://wx1.sinaimg.cn/mw1024/007BSstUly1gosnf204c5j310f0n7tgz.jpg"></p>
<p>原论文的一些细节：</p>
<ul>
<li><p>原文：The cropping is necessary due to the loss of border pixels in every convolution.</p>
<p>得到信息：<strong>得到图片的大小略小于原图</strong>，从图中可以看到输入图片大小（572 x 572），输出图片大小（388 x 388）</p>
</li>
<li><p>原文：To minimize the overhead and make maximum use of the GPU memory, we favor large  input tiles over a large batch size and hence reduce the batch to a single  image.</p>
<p>得到信息：<strong>batch  &#x3D; 1</strong></p>
</li>
<li><p>原文：Accordingly we use a high momentum (0.99) such that a large number of the  previously seen training samples determine the update in the current  optimization step.</p>
<p>得到信息：<strong>动量v&#x3D;0.99</strong></p>
</li>
<li><p>原文：</p>
</li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://example.com/2022/04/05/Unet%E4%BD%BF%E7%94%A8%E6%96%B9%E6%B3%95/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="John Doe">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/04/05/Unet%E4%BD%BF%E7%94%A8%E6%96%B9%E6%B3%95/" class="post-title-link" itemprop="url">Unet使用方法</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>
              

              <time title="Created: 2022-04-05 14:49:53 / Modified: 14:51:10" itemprop="dateCreated datePublished" datetime="2022-04-05T14:49:53+08:00">2022-04-05</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0/" itemprop="url" rel="index"><span itemprop="name">深度学习</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>Welcome to unique_Hang’s blog.</p>
<blockquote>
<p><strong>鲁迅说过：看unique_Hang博客的人颜值都很高！</strong><br> 作者邮箱：<a href="mailto:unique_hang@qq.com">unique_hang@qq.com</a><br>喜欢的小伙伴可以关注我的<a target="_blank" rel="noopener" href="https://space.bilibili.com/290100464">b站账号</a>(<a target="_blank" rel="noopener" href="https://space.bilibili.com/290100464">https://space.bilibili.com/290100464</a>)  </p>
</blockquote>
<h1 id="自己训练数据集步骤"><a href="#自己训练数据集步骤" class="headerlink" title="自己训练数据集步骤"></a>自己训练数据集步骤</h1><ol>
<li><p>准备数据集图片，放入.\datasets\before文件夹，打开labelme（版本：3.16.7）进行标注。</p>
</li>
<li><p>打开json_to_dataset.py，修改classes &#x3D; [“<em>background</em>“,”cat”,”dog”]，第一个背景参数不变，把其他的改为需要分的类。运行该脚本，会生成.&#x2F;datasets&#x2F;JPEGImages文件夹存放原始图片，在datasets&#x2F;SegmentationClass文件夹存放掩图。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><span class="line">import argparse</span><br><span class="line">import base64</span><br><span class="line">import json</span><br><span class="line">import os</span><br><span class="line">import os.path as osp</span><br><span class="line">import warnings</span><br><span class="line"></span><br><span class="line">import numpy as np</span><br><span class="line">import PIL.Image</span><br><span class="line">import yaml</span><br><span class="line">from labelme import utils</span><br><span class="line">import os</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def mkdir(path):</span><br><span class="line">    folder = os.path.exists(path)</span><br><span class="line"></span><br><span class="line">    if not folder:  # 判断是否存在文件夹如果不存在则创建为文件夹</span><br><span class="line">        os.makedirs(path)  # makedirs 创建文件时如果路径不存在会创建这个路径</span><br><span class="line">        print(&#x27;环境配置完毕！&#x27;)</span><br><span class="line">    else:</span><br><span class="line">        print(&#x27;环境检测完毕！&#x27;)</span><br><span class="line"></span><br><span class="line">&#x27;&#x27;&#x27;</span><br><span class="line">我使用的labelme版本是3.16.7，建议使用该版本的labelme，有些版本的labelme会发生错误</span><br><span class="line">此处生成的标签图是8位彩色图，每个像素点的值就是这个像素点所属的种类</span><br><span class="line">&#x27;&#x27;&#x27;</span><br><span class="line">if __name__ == &#x27;__main__&#x27;:</span><br><span class="line">    mkdir(&quot;datasets/JPEGImages&quot;)</span><br><span class="line">    mkdir(&quot;datasets/SegmentationClass&quot;)</span><br><span class="line">    jpgs_path = &quot;datasets/JPEGImages&quot;</span><br><span class="line">    pngs_path = &quot;datasets/SegmentationClass&quot;</span><br><span class="line">    #classes = [&quot;_background_&quot;,&quot;aeroplane&quot;, &quot;bicycle&quot;, &quot;bird&quot;, &quot;boat&quot;, &quot;bottle&quot;, &quot;bus&quot;, &quot;car&quot;, &quot;cat&quot;, &quot;chair&quot;, &quot;cow&quot;, &quot;diningtable&quot;, &quot;dog&quot;, &quot;horse&quot;, &quot;motorbike&quot;, &quot;person&quot;, &quot;pottedplant&quot;, &quot;sheep&quot;, &quot;sofa&quot;, &quot;train&quot;, &quot;tvmonitor&quot;]</span><br><span class="line">    # classes = [&quot;_background_&quot;,&quot;cat&quot;,&quot;dog&quot;]</span><br><span class="line">    classes = [&quot;_background_&quot;, &quot;1&quot;]</span><br><span class="line">    </span><br><span class="line">    count = os.listdir(&quot;./datasets/before/&quot;) </span><br><span class="line">    for i in range(0, len(count)):</span><br><span class="line">        path = os.path.join(&quot;./datasets/before&quot;, count[i])</span><br><span class="line"></span><br><span class="line">        if os.path.isfile(path) and path.endswith(&#x27;json&#x27;):</span><br><span class="line">            data = json.load(open(path))</span><br><span class="line">            </span><br><span class="line">            if data[&#x27;imageData&#x27;]:</span><br><span class="line">                imageData = data[&#x27;imageData&#x27;]</span><br><span class="line">            else:</span><br><span class="line">                imagePath = os.path.join(os.path.dirname(path), data[&#x27;imagePath&#x27;])</span><br><span class="line">                with open(imagePath, &#x27;rb&#x27;) as f:</span><br><span class="line">                    imageData = f.read()</span><br><span class="line">                    imageData = base64.b64encode(imageData).decode(&#x27;utf-8&#x27;)</span><br><span class="line"></span><br><span class="line">            img = utils.img_b64_to_arr(imageData)</span><br><span class="line">            label_name_to_value = &#123;&#x27;_background_&#x27;: 0&#125;</span><br><span class="line">            for shape in data[&#x27;shapes&#x27;]:</span><br><span class="line">                label_name = shape[&#x27;label&#x27;]</span><br><span class="line">                if label_name in label_name_to_value:</span><br><span class="line">                    label_value = label_name_to_value[label_name]</span><br><span class="line">                else:</span><br><span class="line">                    label_value = len(label_name_to_value)</span><br><span class="line">                    label_name_to_value[label_name] = label_value</span><br><span class="line">            </span><br><span class="line">            # label_values must be dense</span><br><span class="line">            label_values, label_names = [], []</span><br><span class="line">            for ln, lv in sorted(label_name_to_value.items(), key=lambda x: x[1]):</span><br><span class="line">                label_values.append(lv)</span><br><span class="line">                label_names.append(ln)</span><br><span class="line">            assert label_values == list(range(len(label_values)))</span><br><span class="line">            </span><br><span class="line">            lbl = utils.shapes_to_label(img.shape, data[&#x27;shapes&#x27;], label_name_to_value)</span><br><span class="line">            </span><br><span class="line">                </span><br><span class="line">            PIL.Image.fromarray(img).save(osp.join(jpgs_path, count[i].split(&quot;.&quot;)[0]+&#x27;.jpg&#x27;))</span><br><span class="line"></span><br><span class="line">            new = np.zeros([np.shape(img)[0],np.shape(img)[1]])</span><br><span class="line">            for name in label_names:</span><br><span class="line">                index_json = label_names.index(name)</span><br><span class="line">                index_all = classes.index(name)</span><br><span class="line">                new = new + index_all*(np.array(lbl) == index_json)</span><br><span class="line"></span><br><span class="line">            utils.lblsave(osp.join(pngs_path, count[i].split(&quot;.&quot;)[0]+&#x27;.png&#x27;), new)</span><br><span class="line">            print(&#x27;Saved &#x27; + count[i].split(&quot;.&quot;)[0] + &#x27;.jpg and &#x27; + count[i].split(&quot;.&quot;)[0] + &#x27;.png&#x27;)</span><br><span class="line"></span><br></pre></td></tr></table></figure>


</li>
<li><p>把JPEGImages文件夹和SegmentationClass文件夹复制到VOCdevkit&#x2F;VOC2007中，运行voc2unet.py，生成txt文件（存放在.\VOCdevkit\VOC2007\ImageSets\Segmentation）</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line">import os</span><br><span class="line">import random </span><br><span class="line">random.seed(0)</span><br><span class="line"> </span><br><span class="line">segfilepath=r&#x27;./VOC2007/SegmentationClass&#x27;</span><br><span class="line">saveBasePath=r&quot;./VOC2007/ImageSets/Segmentation/&quot;</span><br><span class="line"> </span><br><span class="line">#----------------------------------------------------------------------#</span><br><span class="line">#   想要增加测试集修改trainval_percent</span><br><span class="line">#   修改train_percent用于改变验证集的比例</span><br><span class="line">#----------------------------------------------------------------------#</span><br><span class="line">trainval_percent=1</span><br><span class="line">train_percent=0.9</span><br><span class="line"></span><br><span class="line">temp_seg = os.listdir(segfilepath)</span><br><span class="line">total_seg = []</span><br><span class="line">for seg in temp_seg:</span><br><span class="line">    if seg.endswith(&quot;.png&quot;):</span><br><span class="line">        total_seg.append(seg)</span><br><span class="line"></span><br><span class="line">num=len(total_seg)  </span><br><span class="line">list=range(num)  </span><br><span class="line">tv=int(num*trainval_percent)  </span><br><span class="line">tr=int(tv*train_percent)  </span><br><span class="line">trainval= random.sample(list,tv)  </span><br><span class="line">train=random.sample(trainval,tr)  </span><br><span class="line"> </span><br><span class="line">print(&quot;train and val size&quot;,tv)</span><br><span class="line">print(&quot;traub suze&quot;,tr)</span><br><span class="line">ftrainval = open(os.path.join(saveBasePath,&#x27;trainval.txt&#x27;), &#x27;w&#x27;)  </span><br><span class="line">ftest = open(os.path.join(saveBasePath,&#x27;test.txt&#x27;), &#x27;w&#x27;)  </span><br><span class="line">ftrain = open(os.path.join(saveBasePath,&#x27;train.txt&#x27;), &#x27;w&#x27;)  </span><br><span class="line">fval = open(os.path.join(saveBasePath,&#x27;val.txt&#x27;), &#x27;w&#x27;)  </span><br><span class="line"> </span><br><span class="line">for i  in list:  </span><br><span class="line">    name=total_seg[i][:-4]+&#x27;\n&#x27;  </span><br><span class="line">    if i in trainval:  </span><br><span class="line">        ftrainval.write(name)  </span><br><span class="line">        if i in train:  </span><br><span class="line">            ftrain.write(name)  </span><br><span class="line">        else:  </span><br><span class="line">            fval.write(name)  </span><br><span class="line">    else:  </span><br><span class="line">        ftest.write(name)  </span><br><span class="line">  </span><br><span class="line">ftrainval.close()  </span><br><span class="line">ftrain.close()  </span><br><span class="line">fval.close()  </span><br><span class="line">ftest .close()</span><br><span class="line"></span><br></pre></td></tr></table></figure>
</li>
<li><p>运行train.py进行训练，修改num_classes参数，设置成 类别个数+1（背景类）</p>
</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br></pre></td><td class="code"><pre><span class="line">import time</span><br><span class="line">import tensorflow as tf</span><br><span class="line">import tensorflow.keras</span><br><span class="line">import numpy as np</span><br><span class="line">from tensorflow.keras import backend as K</span><br><span class="line">from tensorflow.keras.callbacks import (EarlyStopping, ModelCheckpoint, ReduceLROnPlateau,</span><br><span class="line">                             TensorBoard)</span><br><span class="line">from tensorflow.keras.metrics import categorical_accuracy</span><br><span class="line">from tensorflow.keras.optimizers import Adam</span><br><span class="line">from keras.utils.data_utils import get_file</span><br><span class="line">from PIL import Image</span><br><span class="line"></span><br><span class="line">from nets.unet import Unet</span><br><span class="line">from nets.unet_training import CE, Generator, dice_loss_with_CE</span><br><span class="line">from utils.metrics import Iou_score, f_score</span><br><span class="line"></span><br><span class="line">if __name__ == &quot;__main__&quot;:    </span><br><span class="line">    log_dir = &quot;logs\\&quot;</span><br><span class="line">    #------------------------------#</span><br><span class="line">    #   输入图片的大小</span><br><span class="line">    #------------------------------#</span><br><span class="line">    inputs_size = [512,512,3]</span><br><span class="line">    #------------------------------#</span><br><span class="line">    #   分类个数+1</span><br><span class="line">    #   2+1</span><br><span class="line">    #------------------------------#</span><br><span class="line">    num_classes = 2</span><br><span class="line">    #--------------------------------------------------------------------#</span><br><span class="line">    #   建议选项：</span><br><span class="line">    #   种类少（几类）时，设置为True</span><br><span class="line">    #   种类多（十几类）时，如果batch_size比较大（10以上），那么设置为True</span><br><span class="line">    #   种类多（十几类）时，如果batch_size比较小（10以下），那么设置为False</span><br><span class="line">    #---------------------------------------------------------------------# </span><br><span class="line">    dice_loss = True</span><br><span class="line"></span><br><span class="line">    # 获取model</span><br><span class="line">    model = Unet(inputs_size,num_classes)</span><br><span class="line"></span><br><span class="line">    #-------------------------------------------#</span><br><span class="line">    #   权值文件的下载请看README</span><br><span class="line">    #   权值和主干特征提取网络一定要对应</span><br><span class="line">    #-------------------------------------------#</span><br><span class="line">    #model_path = &quot;./model_data/unet_voc.h5&quot;</span><br><span class="line">    #model.load_weights(model_path, by_name=True, skip_mismatch=True)</span><br><span class="line"></span><br><span class="line">    # 打开数据集的txt</span><br><span class="line">    with open(r&quot;VOCdevkit/VOC2007/ImageSets/Segmentation/train.txt&quot;,&quot;r&quot;) as f:</span><br><span class="line">        train_lines = f.readlines()</span><br><span class="line"></span><br><span class="line">    # 打开数据集的txt</span><br><span class="line">    with open(r&quot;VOCdevkit/VOC2007/ImageSets/Segmentation/val.txt&quot;,&quot;r&quot;) as f:</span><br><span class="line">        val_lines = f.readlines()</span><br><span class="line">        </span><br><span class="line">    #-------------------------------------------------------------------------------#</span><br><span class="line">    #   训练参数的设置</span><br><span class="line">    #   logging表示tensorboard的保存地址</span><br><span class="line">    #   checkpoint用于设置权值保存的细节，period用于修改多少epoch保存一次</span><br><span class="line">    #   reduce_lr用于设置学习率下降的方式</span><br><span class="line">    #   early_stopping用于设定早停，val_loss多次不下降自动结束训练，表示模型基本收敛</span><br><span class="line">    #-------------------------------------------------------------------------------#</span><br><span class="line">    checkpoint_period = ModelCheckpoint(log_dir + &#x27;ep&#123;epoch:03d&#125;-loss&#123;loss:.3f&#125;-val_loss&#123;val_loss:.3f&#125;.h5&#x27;,</span><br><span class="line">                                    monitor=&#x27;val_loss&#x27;, save_weights_only=True, save_best_only=False, period=1)</span><br><span class="line">    reduce_lr = ReduceLROnPlateau(monitor=&#x27;val_loss&#x27;, factor=0.5, patience=3, verbose=1)</span><br><span class="line">    early_stopping = EarlyStopping(monitor=&#x27;val_loss&#x27;, min_delta=0, patience=10, verbose=1)</span><br><span class="line">    tensorboard = TensorBoard(log_dir=log_dir)</span><br><span class="line"></span><br><span class="line">    freeze_layers = 17</span><br><span class="line"></span><br><span class="line">    for i in range(freeze_layers): model.layers[i].trainable = False</span><br><span class="line">    print(&#x27;Freeze the first &#123;&#125; layers of total &#123;&#125; layers.&#x27;.format(freeze_layers, len(model.layers)))</span><br><span class="line"></span><br><span class="line">    #------------------------------------------------------#</span><br><span class="line">    #   主干特征提取网络特征通用，冻结训练可以加快训练速度</span><br><span class="line">    #   也可以在训练初期防止权值被破坏。</span><br><span class="line">    #   Init_Epoch为起始世代</span><br><span class="line">    #   Freeze_Epoch为冻结训练的世代</span><br><span class="line">    #   Epoch总训练世代</span><br><span class="line">    #   提示OOM或者显存不足请调小Batch_size</span><br><span class="line">    #------------------------------------------------------#</span><br><span class="line">    if True:</span><br><span class="line">        lr = 1e-4</span><br><span class="line">        Init_Epoch = 0</span><br><span class="line">        Freeze_Epoch = 50</span><br><span class="line">        Batch_size = 2</span><br><span class="line"></span><br><span class="line">        model.compile(loss = dice_loss_with_CE() if dice_loss else CE(),</span><br><span class="line">                optimizer = Adam(lr=lr),</span><br><span class="line">                metrics = [f_score()])</span><br><span class="line">        print(&#x27;Train on &#123;&#125; samples, val on &#123;&#125; samples, with batch size &#123;&#125;.&#x27;.format(len(train_lines), len(val_lines), Batch_size))</span><br><span class="line"></span><br><span class="line">        gen = Generator(Batch_size, train_lines, inputs_size, num_classes).generate()</span><br><span class="line">        gen_val = Generator(Batch_size, val_lines, inputs_size, num_classes).generate(False)</span><br><span class="line"></span><br><span class="line">        model.fit_generator(gen,</span><br><span class="line">                steps_per_epoch=max(1, len(train_lines)//Batch_size),</span><br><span class="line">                validation_data=gen_val,</span><br><span class="line">                validation_steps=max(1, len(val_lines)//Batch_size),</span><br><span class="line">                epochs=Freeze_Epoch,</span><br><span class="line">                initial_epoch=Init_Epoch,</span><br><span class="line">                callbacks=[checkpoint_period, reduce_lr,tensorboard])</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    for i in range(freeze_layers): model.layers[i].trainable = True</span><br><span class="line"></span><br><span class="line">    if True:</span><br><span class="line">        lr = 1e-5</span><br><span class="line">        Freeze_Epoch = 50</span><br><span class="line">        Unfreeze_Epoch = 100</span><br><span class="line">        Batch_size = 2</span><br><span class="line"></span><br><span class="line">        model.compile(loss = dice_loss_with_CE() if dice_loss else CE(),</span><br><span class="line">                optimizer = Adam(lr=lr),</span><br><span class="line">                metrics = [f_score()])</span><br><span class="line">        print(&#x27;Train on &#123;&#125; samples, val on &#123;&#125; samples, with batch size &#123;&#125;.&#x27;.format(len(train_lines), len(val_lines), Batch_size))</span><br><span class="line"></span><br><span class="line">        gen = Generator(Batch_size, train_lines, inputs_size, num_classes).generate()</span><br><span class="line">        gen_val = Generator(Batch_size, val_lines, inputs_size, num_classes).generate(False)</span><br><span class="line">        </span><br><span class="line">        model.fit_generator(gen,</span><br><span class="line">                steps_per_epoch=max(1, len(train_lines)//Batch_size),</span><br><span class="line">                validation_data=gen_val,</span><br><span class="line">                validation_steps=max(1, len(val_lines)//Batch_size),</span><br><span class="line">                epochs=Unfreeze_Epoch,</span><br><span class="line">                initial_epoch=Freeze_Epoch,</span><br><span class="line">                callbacks=[checkpoint_period, reduce_lr,tensorboard])</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h1 id="图片预测"><a href="#图片预测" class="headerlink" title="图片预测"></a>图片预测</h1><p>在unet.py中更改三处，1.model_path设置为想要的模型路径。2.num_classes设置为 类别数+1</p>
<p>3.def generate(self):函数的路径</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br></pre></td><td class="code"><pre><span class="line">import colorsys</span><br><span class="line">import copy</span><br><span class="line">import os</span><br><span class="line"></span><br><span class="line">import numpy as np</span><br><span class="line">from PIL import Image</span><br><span class="line"></span><br><span class="line">from nets.unet import Unet as unet</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#--------------------------------------------#</span><br><span class="line">#   使用自己训练好的模型预测需要修改2个参数</span><br><span class="line">#   model_path和num_classes都需要修改！</span><br><span class="line">#   如果出现shape不匹配</span><br><span class="line">#   一定要注意训练时的model_path和num_classes数的修改</span><br><span class="line">#--------------------------------------------#</span><br><span class="line">class Unet(object):</span><br><span class="line">    _defaults = &#123;</span><br><span class="line">        &quot;model_path&quot;        : &#x27;1.h5&#x27;,</span><br><span class="line">        &quot;model_image_size&quot;  : (512, 512, 3),</span><br><span class="line">        &quot;num_classes&quot;       : 2,</span><br><span class="line">        #--------------------------------#</span><br><span class="line">        #   blend参数用于控制是否</span><br><span class="line">        #   让识别结果和原图混合</span><br><span class="line">        #--------------------------------#</span><br><span class="line">        &quot;blend&quot;             : True,</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    #---------------------------------------------------#</span><br><span class="line">    #   初始化UNET</span><br><span class="line">    #---------------------------------------------------#</span><br><span class="line">    def __init__(self, **kwargs):</span><br><span class="line">        self.__dict__.update(self._defaults)</span><br><span class="line">        self.generate()</span><br><span class="line"></span><br><span class="line">    #---------------------------------------------------#</span><br><span class="line">    #   载入模型</span><br><span class="line">    #---------------------------------------------------#</span><br><span class="line">    def generate(self):</span><br><span class="line">        #-------------------------------#</span><br><span class="line">        #   载入模型与权值</span><br><span class="line">        #-------------------------------#</span><br><span class="line">        self.model = unet(self.model_image_size, self.num_classes)</span><br><span class="line"></span><br><span class="line">        self.model.load_weights(self.model_path)</span><br><span class="line">        print(&#x27;&#123;&#125; model loaded.&#x27;.format(self.model_path))</span><br><span class="line">        </span><br><span class="line">        </span><br><span class="line">        if self.num_classes == 2:</span><br><span class="line">            self.colors = [(255, 255, 255),  (0, 0, 0)]</span><br><span class="line">        elif self.num_classes &lt;= 21:</span><br><span class="line">            self.colors = [(0, 0, 0), (128, 0, 0), (0, 128, 0), (128, 128, 0), (0, 0, 128), (128, 0, 128), (0, 128, 128), </span><br><span class="line">                    (128, 128, 128), (64, 0, 0), (192, 0, 0), (64, 128, 0), (192, 128, 0), (64, 0, 128), (192, 0, 128), </span><br><span class="line">                    (64, 128, 128), (192, 128, 128), (0, 64, 0), (128, 64, 0), (0, 192, 0), (128, 192, 0), (0, 64, 128), (128, 64, 12)]</span><br><span class="line">        else:</span><br><span class="line">            # 画框设置不同的颜色</span><br><span class="line">            hsv_tuples = [(x / len(self.class_names), 1., 1.)</span><br><span class="line">                        for x in range(len(self.class_names))]</span><br><span class="line">            self.colors = list(map(lambda x: colorsys.hsv_to_rgb(*x), hsv_tuples))</span><br><span class="line">            self.colors = list(</span><br><span class="line">                map(lambda x: (int(x[0] * 255), int(x[1] * 255), int(x[2] * 255)),</span><br><span class="line">                    self.colors))</span><br><span class="line"></span><br><span class="line">    def letterbox_image(self ,image, size):</span><br><span class="line">        image = image.convert(&quot;RGB&quot;)</span><br><span class="line">        iw, ih = image.size</span><br><span class="line">        w, h = size</span><br><span class="line">        scale = min(w/iw, h/ih)</span><br><span class="line">        nw = int(iw*scale)</span><br><span class="line">        nh = int(ih*scale)</span><br><span class="line"></span><br><span class="line">        image = image.resize((nw,nh), Image.BICUBIC)</span><br><span class="line">        new_image = Image.new(&#x27;RGB&#x27;, size, (128,128,128))</span><br><span class="line">        new_image.paste(image, ((w-nw)//2, (h-nh)//2))</span><br><span class="line">        return new_image,nw,nh</span><br><span class="line"></span><br><span class="line">    #---------------------------------------------------#</span><br><span class="line">    #   检测图片</span><br><span class="line">    #---------------------------------------------------#</span><br><span class="line">    def detect_image(self, image):</span><br><span class="line">        #---------------------------------------------------#</span><br><span class="line">        #   对输入图像进行一个备份，后面用于绘图</span><br><span class="line">        #---------------------------------------------------#</span><br><span class="line">        old_img = copy.deepcopy(image)</span><br><span class="line">        orininal_h = np.array(image).shape[0]</span><br><span class="line">        orininal_w = np.array(image).shape[1]</span><br><span class="line"></span><br><span class="line">        #---------------------------------------------------#</span><br><span class="line">        #   进行不失真的resize，添加灰条，进行图像归一化</span><br><span class="line">        #---------------------------------------------------#</span><br><span class="line">        img, nw, nh = self.letterbox_image(image,(self.model_image_size[1],self.model_image_size[0]))</span><br><span class="line">        img = np.asarray([np.array(img)/255])</span><br><span class="line">        </span><br><span class="line">        #---------------------------------------------------#</span><br><span class="line">        #   图片传入网络进行预测</span><br><span class="line">        #---------------------------------------------------#</span><br><span class="line">        pr = self.model.predict(img)[0]</span><br><span class="line">        #---------------------------------------------------#</span><br><span class="line">        #   取出每一个像素点的种类</span><br><span class="line">        #---------------------------------------------------#</span><br><span class="line">        pr = pr.argmax(axis=-1).reshape([self.model_image_size[0],self.model_image_size[1]])</span><br><span class="line">        #--------------------------------------#</span><br><span class="line">        #   将灰条部分截取掉</span><br><span class="line">        #--------------------------------------#</span><br><span class="line">        pr = pr[int((self.model_image_size[0]-nh)//2):int((self.model_image_size[0]-nh)//2+nh), int((self.model_image_size[1]-nw)//2):int((self.model_image_size[1]-nw)//2+nw)]</span><br><span class="line"></span><br><span class="line">        #------------------------------------------------#</span><br><span class="line">        #   创建一副新图，并根据每个像素点的种类赋予颜色</span><br><span class="line">        #------------------------------------------------#</span><br><span class="line">        seg_img = np.zeros((np.shape(pr)[0],np.shape(pr)[1],3))</span><br><span class="line">        for c in range(self.num_classes):</span><br><span class="line">            seg_img[:,:,0] += ((pr[:,: ] == c )*( self.colors[c][0] )).astype(&#x27;uint8&#x27;)</span><br><span class="line">            seg_img[:,:,1] += ((pr[:,: ] == c )*( self.colors[c][1] )).astype(&#x27;uint8&#x27;)</span><br><span class="line">            seg_img[:,:,2] += ((pr[:,: ] == c )*( self.colors[c][2] )).astype(&#x27;uint8&#x27;)</span><br><span class="line"></span><br><span class="line">        #------------------------------------------------#</span><br><span class="line">        #   将新图片转换成Image的形式</span><br><span class="line">        #------------------------------------------------#</span><br><span class="line">        image = Image.fromarray(np.uint8(seg_img)).resize((orininal_w,orininal_h), Image.NEAREST)</span><br><span class="line"></span><br><span class="line">        #------------------------------------------------#</span><br><span class="line">        #   将新图片和原图片混合</span><br><span class="line">        #------------------------------------------------#</span><br><span class="line">        if self.blend:</span><br><span class="line">            image = Image.blend(old_img,image,0.7)</span><br><span class="line"></span><br><span class="line">        return image</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>运行predict.py</p>
<p><strong>注意：</strong>如果报错AttributeError: ‘str’ object has no attribute ‘decode’</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install h5py==2.10 -i https://pypi.doubanio.com/simple</span><br></pre></td></tr></table></figure>


      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/"><i class="fa fa-angle-left" aria-label="Previous page"></i></a><a class="page-number" href="/">1</a><span class="page-number current">2</span><a class="page-number" href="/page/3/">3</a><a class="extend next" rel="next" href="/page/3/"><i class="fa fa-angle-right" aria-label="Next page"></i></a>
  </nav>



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">John Doe</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">26</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">2</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2022</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">John Doe</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://muse.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Muse</a>
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/muse.js"></script>


<script src="/js/next-boot.js"></script>




  















  

  

</body>
</html>
